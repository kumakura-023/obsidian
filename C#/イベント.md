---
created: 2025-11-11T14:43
updated: 2025-11-11T14:43
---
### 🔹まず「イベント」とは何か

ざっくり言うと、

> **「何かが起きたことを、関心のある人に知らせる仕組み」**。

プログラムの世界では「起きたこと」を**イベント**と呼ぶ。  
そして「知らせたい相手（受け取り側）」を**イベントハンドラ（event handler）という。

#### 例でイメージしよう

たとえばボタンをクリックしたら何かしたい場合。
```C#
button.Click += OnButtonClick;`
```
これは
> 「`button` がクリックされたら、`OnButtonClick` メソッドを呼んでね」  
> という“通知の登録”をしている。

つまり：

- `button` が「クリックされたよ！」という**イベントを発火する**
    
- `OnButtonClick` が「じゃあこれを実行する」という**受け取り側（ハンドラ）**
    

これがC#のイベントの基本構造。

### 🔹イベントを「発火する」とは？

「イベントを発火する（raise / fire）」＝「購読してる関数を呼ぶ」こと。

ここで出てくるのが質問の行：

```C#

public event EventHandler<IReadOnlyList<string>>? PortsChanged;
....

PortsChanged?.Invoke(this, GetCurrentPorts());
```

分解するとこう👇：

|部分|意味|
|---|---|
|`PortsChanged`|イベントそのもの。購読者がいれば関数参照が入ってる。|
|`?.`|「購読者がいれば呼ぶ、いなければ何もしない」安全演算子（nullチェック）。|
|`Invoke(...)`|実際に登録されている関数を呼び出す。|
|`this`|発火元＝`SerialPortCatalog` 自身（= sender）。|
|`GetCurrentPorts()`|イベントの引数（最新のポート一覧）。|

つまりこの1行は：

> 「購読している人（UIなど）がいれば、  
> 『ポート一覧が変わったよ！最新の一覧はこれだよ！』と通知する」

という意味。

### 🔹購読側（受け取る側）はどう書くの？

たとえば ViewModel 側で：

```C#
_portCatalog.PortsChanged += (sender, ports) => {
	UpdatePorts(ports); //PortsChangedイベントが発火したら呼ばれる。
};
```

この `+=` は**購読を登録**している。  
内部的には `PortsChanged` イベントに「このメソッドを呼んでね」と渡してるだけ。

`Invoke()` が呼ばれると、登録してあったすべてのメソッドが実行される。  
つまり「誰かが挿した／抜いた」を感知してUIリストを更新できる。

### 🔹登録される仕組み

この `+=` は「イベントに関数を追加する」という意味。  
複数登録もできる。

```C#
_portCatalog.PortsChanged += OnPortsChanged;
_portCatalog.PortsChanged += LogPortChange;
```

この場合、`PortsChanged` が発火すると：

1. `OnPortsChanged(...)`
    
2. `LogPortChange(...)`  
    が**順番に実行される**。
    

逆に購読解除するには `-=` を使う。

`_portCatalog.PortsChanged -= OnPortsChanged;`

### 🔹補足：ラムダ式の形

```C#
(sender, ports) => { UpdatePorts(ports); }
```


これは無名関数（ラムダ式）。  
`EventHandler<IReadOnlyList<string>>` 型に合ってる。

イベントは引数を2つ受け取るのが決まり：

- `sender` … イベントを発火したオブジェクト（ここでは `SerialPortCatalog` 自身）
    
- `ports` … イベントデータ（この場合はポート名のリスト）